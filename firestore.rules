/**
 * @file Firebase Security Rules for MediCare Assist.
 *
 * @core_philosophy This ruleset enforces a strict user-ownership model. Each user can only access their own data stored under their /users/{userId} path.
 * @data_structure All user data is nested under /users/{userId}, ensuring clear ownership.
 * @key_security_decisions
 *   - Users cannot list all other users.
 *   - Data validation is relaxed during prototyping to focus on authorization.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    function isOwner(userId) {
      return request.auth.uid == userId;
    }

    match /users/{userId} {
      allow read, write: if isOwner(userId);

      match /medications/{medicationId} {
        allow read, write: if isOwner(userId);
      }

      match /medicationlogs/{logId} {
        allow read, write: if isOwner(userId);
      }
    }
  }
}
